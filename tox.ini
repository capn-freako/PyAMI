[tox]
envlist = py39, py310, format, lint, type-check, docs
skip_missing_interpreters = true
isolated_build = true

[testenv]
changedir = tests
deps =
    pytest
	pytest-cov
    pytest-xdist
conda_deps =
    parsec =3.13
    empy
    scipy
    matplotlib
    Cython
    # PyQt5
conda_channels =
    dbanas
    defaults
conda_install_args =
    --use-local
commands =
    py.test --basetemp={envtmpdir} --cov=pyibisami \
            --cov-report=html --cov-report=term-missing
# install_command = conda install --use-local -c dbanas -c defaults {packages}

[testenv:format]
skip_install = true
deps =
    black
    isort
    autoflake
    docformatter[tomli]
commands =
    autoflake --in-place --remove-all-unused-imports --expand-star-imports \
        --ignore-init-module-imports --recursive src/
    docformatter --in-place --recursive src/
    isort src/
    black src/

[testenv:lint]
deps =
    pylint
commands =
    pylint src/

[testenv:type-check]
setenv =
    MYPYPATH = {toxinidir}
deps = mypy
commands = mypy --ignore-missing-imports src/

[testenv:docs]
deps =
    numpy
    Cython
	sphinx
    m2r
changedir = docs
commands =
    sphinx-build -j auto -b html source/ build/
